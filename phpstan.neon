includes:
    - vendor/larastan/larastan/extension.neon

parameters:
    level: 5
    paths:
        - src
    excludePaths:
        - vendor
    tmpDir: build/phpstan

    ignoreErrors:
        # betterauth-core (local dependency during development)
        - '#class BetterAuth\\Core\\#'

        # Larastan env() rule - we use dynamic env vars for OAuth
        - '#Called .env. outside of the config directory#'

        # Intersection types with Model&Authenticatable
        - '#Parameter \#1 \$user of method .+ expects .+Model, .+ given#'

        # PHPDoc parsing for intersection types
        - '#PHPDoc tag @var has invalid value .+Model&Authenticatable#'

        # Eloquent model dynamic properties (package doesn't know user model)
        - '#Access to an undefined property Illuminate\\Database\\Eloquent\\Model::\$#'
        - '#Call to an undefined method Illuminate\\Database\\Eloquent\\Model::#'

        # Properties reserved for future use
        - identifier: property.onlyWritten
          path: src/Guards/*
        - identifier: property.onlyWritten
          path: src/Http/Middleware/*
        - identifier: property.unusedType
          path: src/Guards/*

        # Return type compatibility (Laravel interface evolution)
        - identifier: method.childReturnType
          path: src/Guards/*

        # Nullsafe on non-nullable (safe defensive coding)
        - identifier: nullsafe.neverNull

        # Null coalesce on non-nullable (safe defensive coding)
        - identifier: nullCoalesce.expr

        # Isset on always-existing offset (defensive coding)
        - identifier: isset.offset

        # method_exists check (runtime safety)
        - identifier: function.alreadyNarrowedType

        # Parameter type in login (handled at runtime)
        - '#Parameter \#1 \$user of method .+::login\(\) expects .+Authenticatable, null given#'

        # Trait analysis (trait is used by user's model, not in package)
        - identifier: trait.unused
          path: src/Models/Traits/*

        # Socialite optional dependency - methods exist at runtime
        - '#Call to an undefined method Laravel\\Socialite\\Contracts\\Provider::#'
        - '#Access to an undefined property Laravel\\Socialite\\Contracts\\User::\$#'

        # UserProvider return types (Model implements Authenticatable via user's model)
        - '#should return Illuminate\\Contracts\\Auth\\Authenticatable\|null but returns Illuminate\\Database\\Eloquent\\Model\|null#'

        # Comparison with PHPDoc types
        - identifier: identical.alwaysFalse

    stubFiles:
        - stubs/phpstan/betterauth-core.stub
